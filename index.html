<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Trip Command Center</title>
  <meta name="description" content="Run hour-by-hour travel plans with pins, maps, restaurants, and budget — optimized for phone." />

  <style>
    :root{
      --bg:#0b0f14;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.045);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.52);
      --accent: #ffffff;
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --radius: 18px;
      --radius2: 14px;
      --max: 1120px;

      --h1: clamp(28px, 3.6vw, 46px);
      --h2: 18px;
      --body: 15px;
      --small: 12px;
      --tight: -0.6px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 900px at 20% -10%, rgba(255,255,255,.08), transparent 60%),
                  radial-gradient(1000px 800px at 80% 0%, rgba(255,255,255,.06), transparent 60%),
                  var(--bg);
      color:var(--text);
      letter-spacing:-.1px;
    }
    a{color:inherit}
    button{font:inherit}
    .wrap{max-width:var(--max); margin:0 auto; padding:18px 16px 90px;}
    @media(min-width:980px){ .wrap{padding-bottom:26px;} }

    /* Topbar (desktop/tablet) */
    .topbar{
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(11,15,20,.88), rgba(11,15,20,.70));
      border-bottom: 1px solid rgba(255,255,255,.08);
      transition: transform .22s ease;
    }
    .topbar.is-hidden{ transform: translateY(-105%); }
    .topbar__inner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 12px 16px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
    }
    .brand{display:flex; gap:12px; align-items:center; min-width: 220px;}
    .brand__logo{
      width:40px; height:40px; border-radius:12px;
      background: linear-gradient(145deg, rgba(255,255,255,.16), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
    }
    .brand__name{font-weight:800; letter-spacing: var(--tight); line-height:1.05;}
    .brand__sub{font-size:12px; color:var(--muted); margin-top:3px;}
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;}
    .select{
      appearance:none;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      outline:none;
      min-width: 210px;
    }

    .nav{
      display:flex; gap:6px; align-items:center;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      padding: 4px;
      border-radius: 14px;
    }
    .navBtn{
      border:0;
      padding: 9px 11px;
      border-radius: 12px;
      background: transparent;
      color: var(--muted);
      cursor:pointer;
      white-space:nowrap;
    }
    .navBtn.is-active{
      background: rgba(255,255,255,.10);
      color: var(--text);
      border:1px solid rgba(255,255,255,.10);
    }

    .primaryCta{
      text-decoration:none;
      display:inline-flex; align-items:center; justify-content:center;
      padding: 10px 14px;
      border-radius: 14px;
      background: #fff;
      color: #0b0f14;
      font-weight:800;
      border: 1px solid rgba(255,255,255,.20);
      box-shadow: 0 12px 35px rgba(0,0,0,.45);
    }
    .ghostCta{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 10px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--text);
      text-decoration:none;
      font-weight:700;
    }

    /* Mobile bottom nav */
    .bottomNav{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      z-index: 60;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(to top, rgba(11,15,20,.92), rgba(11,15,20,.55));
      border-top: 1px solid rgba(255,255,255,.08);
      display:flex; gap:10px;
    }
    .bottomNav .navItem{
      flex:1;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      border-radius: 16px;
      padding: 12px 10px;
      text-align:center;
      font-weight:800;
      letter-spacing:-.2px;
    }
    .bottomNav .navItem.is-active{
      background:#fff;
      color:#0b0f14;
      border-color: rgba(255,255,255,.25);
    }
    @media(min-width:980px){ .bottomNav{display:none;} }

    /* Views */
    .view{display:none}
    .view.is-active{display:block}

    /* Hero */
    .hero{
      padding: 18px 0 14px;
    }
    .kicker{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .pill{
      font-size: 12px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--muted);
    }
    .heroTitle{
      font-size: var(--h1);
      letter-spacing: var(--tight);
      font-weight: 900;
      line-height: 1.03;
      margin: 0 0 10px;
    }
    .heroSub{
      margin:0;
      color: var(--muted);
      max-width: 70ch;
      line-height: 1.35;
      font-size: 15px;
    }
    .heroActions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 16px;
    }

    /* Sections */
    .section{
      margin-top: 18px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      overflow:hidden;
    }
    .sectionHeader{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .sectionHeader h2{margin:0; font-size:16px; letter-spacing:-.2px;}
    .sectionHeader p{margin:0; color:var(--muted); font-size:12px}
    .sectionBody{padding: 14px;}

    /* Day cards (Plan) */
    .dayCard{
      border-radius: var(--radius);
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.09);
      padding: 14px;
      margin-bottom: 12px;
    }
    .dayTop{
      display:flex; justify-content:space-between; gap:12px; align-items:flex-start;
    }
    .dayTitle{
      font-weight: 950;
      letter-spacing: -0.6px;
      font-size: 18px;
      line-height: 1.1;
      margin:0;
    }
    .dayTags{display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end;}
    .tag{
      font-size: 12px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      white-space:nowrap;
    }
    .timeline{
      margin-top: 10px;
      padding-left: 18px;
      color: var(--text);
      line-height: 1.45;
    }
    .timeline li{margin:6px 0; color: rgba(255,255,255,.86);}
    .timeline span{color: var(--muted);}
    .dayActions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 12px;
    }
    .btn{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 800;
      cursor:pointer;
    }
    .btn.primary{
      background: #fff;
      color: #0b0f14;
      border-color: rgba(255,255,255,.25);
    }
    .btn.small{padding:9px 11px; font-size:13px; border-radius: 12px;}
    .btn:active{transform: scale(.99);}

    /* Map view */
    .mapFrame{
      width:100%;
      aspect-ratio: 16/10;
      border:0;
      border-radius: 18px;
      overflow:hidden;
      background: rgba(255,255,255,.03);
    }
    @media(max-width:560px){
      .mapFrame{aspect-ratio: 10/14;}
    }
    .searchRow{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top: 12px;
    }
    .searchRow input{
      flex:1;
      min-width: 220px;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      outline:none;
    }

    .pinList{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media(min-width:900px){
      .pinList{grid-template-columns: 1fr 1fr;}
    }
    .pinItem{
      padding: 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.05);
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
    }
    .pinItem strong{display:block; font-weight:900; letter-spacing:-.3px;}
    .pinItem small{display:block; color: var(--muted); margin-top:2px;}
    .pinItem a{
      white-space:nowrap;
      text-decoration:none;
      font-weight:900;
      padding: 9px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }

    /* Budget */
    .budgetCard{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 18px;
      padding: 16px;
    }
    .budgetHeader{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;}
    .budgetHeader h2{margin:0;font-size:18px;letter-spacing:-.2px;}
    .budgetMeta{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;}
    .budgetTop{display:grid;gap:14px;margin-top:14px;}
    @media (min-width: 860px){
      .budgetTop{grid-template-columns: 1fr 1.2fr; align-items:stretch;}
    }
    .budgetTotal .label{opacity:.8;font-size:12px;margin-bottom:6px;}
    .budgetTotal .value{font-size:34px;font-weight:950;letter-spacing:-.8px;}
    .budgetTotal .sub{opacity:.8;margin-top:4px;font-size:13px;}
    .budgetSplit{display:flex;flex-direction:column;gap:10px;}
    .splitRow{
      display:flex;align-items:baseline;gap:10px;justify-content:space-between;
      padding:12px;border-radius:14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
    }
    .splitRow span{opacity:.9}
    .splitRow em{opacity:.75;font-style:normal;margin-left:auto;}
    .budgetNotes{margin-top:12px;}
    .budgetNotes summary{cursor:pointer;opacity:.9}
    .budgetNotes ul{margin:10px 0 0 18px;opacity:.85}
    .budgetDays{margin-top:14px;display:flex;flex-direction:column;gap:10px;}
    .dayRow{
      width:100%;
      display:grid;
      grid-template-columns: 1fr auto auto;
      gap:10px;
      align-items:center;
      padding:12px 14px;
      border-radius:14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      color: inherit;
      cursor:pointer;
    }
    .dayRow strong{font-weight:950}
    .dayRow em{opacity:.75;font-style:normal}

    /* Drawer */
    .drawerBackdrop{
      position:fixed; inset:0; z-index:80;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      display:none;
      padding: 16px;
    }
    .drawerBackdrop.is-open{display:flex; align-items:flex-end; justify-content:center;}
    .drawer{
      width:min(720px, 100%);
      border-radius: 22px 22px 16px 16px;
      background: rgba(15,20,28,.96);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
      overflow:hidden;
      max-height: 82vh;
      display:flex; flex-direction:column;
    }
    .drawerHeader{
      padding: 14px 14px;
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .drawerHeader h3{margin:0; font-size:16px; font-weight:950; letter-spacing:-.3px;}
    .drawerHeader p{margin:4px 0 0; color:var(--muted); font-size:12px}
    .drawerClose{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 12px;
      padding: 9px 11px;
      cursor:pointer;
      font-weight:900;
    }
    .drawerBody{
      padding: 12px 14px 14px;
      overflow:auto;
    }
    .restItem{
      padding: 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.05);
      margin-bottom: 10px;
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
    }
    .restItem strong{display:block; font-weight:950;}
    .restItem small{display:block; color:var(--muted); margin-top:2px}
    .restItem a{
      text-decoration:none;
      font-weight:950;
      padding: 9px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      white-space:nowrap;
    }

    /* Footer */
    footer{
      margin-top: 18px;
      padding: 16px;
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 12px;
      display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center;
    }
    footer a{opacity:.9}
  </style>
</head>

<body>

  <!-- TOPBAR -->
  <header class="topbar" id="topbar">
    <div class="topbar__inner">
      <div class="brand">
        <div class="brand__logo" aria-hidden="true"></div>
        <div>
          <div class="brand__name">Trip Command Center · Nikita</div>
          <div class="brand__sub" id="routeLine">—</div>
        </div>
      </div>

      <div class="controls">
        <select id="tripSelect" class="select" aria-label="Select trip"></select>

        <nav class="nav" aria-label="Primary navigation">
          <button class="navBtn is-active" data-view="plan">Plan</button>
          <button class="navBtn" data-view="map">Map</button>
          <button class="navBtn" data-view="food">Food</button>
          <button class="navBtn" data-view="budget">Budget</button>
        </nav>

        <a id="openGoogleMapTop" class="primaryCta" href="#" target="_blank" rel="noopener">Open Google Map</a>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- HERO -->
    <section class="hero">
      <div class="kicker" id="heroPills"></div>
      <h1 class="heroTitle" id="heroTitle">—</h1>
      <p class="heroSub" id="heroSub">—</p>

      <div class="heroActions">
        <a id="openGoogleMapHero" class="primaryCta" href="#" target="_blank" rel="noopener">Open Live Google Map</a>
        <button class="btn" id="goPlan">View Plan</button>
        <button class="btn" id="goMap">View Map</button>
      </div>
    </section>

    <!-- VIEWS -->
    <section id="view-plan" class="view is-active"></section>
    <section id="view-map" class="view"></section>
    <section id="view-food" class="view"></section>
    <section id="view-budget" class="view"></section>

    <footer>
      <div>Built to run from your phone. Multi-trip ready.</div>
      <div>
        <a href="#" id="footerGoogleMap" target="_blank" rel="noopener">Open Google Map</a>
        ·
        <a href="#" id="footerShare">Share link</a>
      </div>
    </footer>
  </div>

  <!-- MOBILE BOTTOM NAV -->
  <div class="bottomNav" aria-label="Bottom navigation">
    <button class="navItem is-active" data-view="plan">Plan</button>
    <button class="navItem" data-view="map">Map</button>
    <button class="navItem" data-view="food">Food</button>
    <button class="navItem" data-view="budget">Budget</button>
  </div>

  <!-- RESTAURANTS DRAWER -->
  <div class="drawerBackdrop" id="drawerBackdrop" role="dialog" aria-modal="true" aria-label="Restaurant drawer">
    <div class="drawer">
      <div class="drawerHeader">
        <div>
          <h3 id="drawerTitle">Restaurants</h3>
          <p id="drawerSub">—</p>
        </div>
        <button class="drawerClose" id="drawerClose">Close</button>
      </div>
      <div class="drawerBody" id="drawerBody"></div>
    </div>
  </div>

<script>
/* =========================
   DATA (Multi-trip ready)
   Add trips here. UI auto-updates.
========================= */

const TRIPS = {
  peru: {
    id: "peru",
    name: "Peru Trip (Jan 15–21)",
    routeLine: "Lima → Paracas → Cusco → Machu Picchu → Nazca → Lima",
    heroTitle: "Peru, run hour-by-hour. Zero guesswork.",
    heroSub: "Plan + map + restaurants + photo spots + budget. Built to run from your phone.",
    pills: ["Optimized for time", "Mid / cheap-mid food", "Pin previews + deep links", "Multi-trip ready"],
    googleMapUrl: "https://maps.app.goo.gl/uTUuF275HcNx2AcP6?g_st=i",
    mapEmbedUrl: "https://www.google.com/maps/d/u/0/embed?mid=1", // optional: replace with your embed if you have it. If not, we’ll use a fallback below.
    days: [
      {
        key: "2026-01-15",
        title: "JAN 15 — Arrival → Coastal Loop → Lima",
        tags: ["Lima", "Pachacamac", "Paracas", "Chincha"],
        locations: ["Lima", "Pachacamac", "Paracas", "Chincha"],
        timeline: [
          "05:00–06:00  Land in Lima, immigration, bags",
          "06:00–06:30  Pick up rental car",
          "06:30–07:15  Drive to Pachacamac",
          "07:15–09:00  Pachacamac",
          "09:00–10:00  Brunch: Hacienda Mamacona",
          "10:00–12:45  Drive to Paracas",
          "12:45–14:30  Paracas National Reserve quick loop",
          "14:30–15:30  Late lunch: Pukasoncco",
          "16:30–17:30  Hacienda San José (Chincha)",
          "19:30–21:00  Dinner: La Lucha or Tanta"
        ]
      },
      {
        key: "2026-01-16",
        title: "JAN 16 — Lima → Cusco (Acclimatization)",
        tags: ["Fly", "Easy walking", "Qorikancha"],
        locations: ["Lima", "Cusco"],
        timeline: [
          "08:00–09:00  To airport, drop car",
          "09:00–11:00  Flight Lima → Cusco",
          "11:30–13:00  Check-in + light lunch (Chakruna Native Burgers)",
          "13:00–15:00  Plaza de Armas walk + coffee",
          "15:00–16:30  Qorikancha",
          "17:00–18:30  Early dinner: Jack’s Café"
        ]
      },
      {
        key: "2026-01-17",
        title: "JAN 17 — Machu Picchu Day",
        tags: ["Circuit 2", "No re-entry", "Train day"],
        locations: ["Cusco", "Aguas Calientes", "Machu Picchu"],
        timeline: [
          "Option A: Belmond Hiram Bingham (Luxury) OR Option B: Vistadome (Mid-range)",
          "Plan timing: Train → Bus → Circuit 2 → Dinner → Train back"
        ]
      },
      {
        key: "2026-01-18",
        title: "JAN 18 — Full Cusco + Night Bus to Nazca",
        tags: ["Sacsayhuamán", "San Blas", "Night bus"],
        locations: ["Cusco", "Nazca"],
        timeline: [
          "10:00–12:00  Sacsayhuamán",
          "12:15–13:00  Q’enqo",
          "13:15–14:00  Lunch: Pachapapa / Green Point Vegan",
          "14:00–15:00  San Blas streets & shops",
          "16:45–18:00  Cathedral + Plaza de Armas",
          "20:00–05:30  Night bus: Cusco → Nazca (Cruz del Sur)"
        ]
      },
      {
        key: "2026-01-19",
        title: "JAN 19 — Nazca Lines Flight + Desert",
        tags: ["Flight", "Cantalloc", "Chauchilla"],
        locations: ["Nazca"],
        timeline: [
          "07:00–09:00  Nazca Lines flight",
          "09:00–10:00  Breakfast: Mamashana",
          "10:30–12:00  Cantalloc Aqueducts",
          "15:00–17:30  Chauchilla Cemetery + desert sunset",
          "19:00–20:30  Dinner: Mamashana / La Kasa Rustika"
        ]
      },
      {
        key: "2026-01-20",
        title: "JAN 20 — Nazca → Lima + Miraflores",
        tags: ["Bus", "Cliff walk", "Dinner"],
        locations: ["Nazca", "Lima", "Miraflores", "Barranco"],
        timeline: [
          "07:30–14:00  Bus: Nazca → Lima (Cruz del Sur)",
          "16:00–18:30  Miraflores clifftop walk",
          "19:30–21:30  Dinner: Panchita / Siete Sopas"
        ]
      }
    ],
    restaurants: [
      // Lima
      { name:"La Lucha Sanguchería", area:"Lima · Miraflores", price:"cheap-mid", why:"fast + reliable", map:"https://www.google.com/maps/search/?api=1&query=La%20Lucha%20Sangucher%C3%ADa%20Miraflores" },
      { name:"Tanta (Larcomar)", area:"Lima · Larcomar", price:"mid", why:"comfort Peruvian + view", map:"https://www.google.com/maps/search/?api=1&query=Tanta%20Larcomar" },
      { name:"Panchita", area:"Lima · Miraflores", price:"mid", why:"classic Peruvian", map:"https://www.google.com/maps/search/?api=1&query=Panchita%20Miraflores" },
      { name:"Siete Sopas", area:"Lima", price:"cheap", why:"famous soups", map:"https://www.google.com/maps/search/?api=1&query=Siete%20Sopas%20Lima" },

      // Pachacamac / Paracas / Chincha
      { name:"Hacienda Mamacona", area:"Pachacamac", price:"mid", why:"traditional + horses vibe", map:"https://www.google.com/maps/search/?api=1&query=Hacienda%20Mamacona" },
      { name:"Pukasoncco Arte y Restaurante", area:"Paracas", price:"cheap-mid", why:"home-style + veg options", map:"https://www.google.com/maps/search/?api=1&query=Pukasoncco%20Paracas" },

      // Cusco
      { name:"Chakruna Native Burgers", area:"Cusco · Center", price:"cheap", why:"highly rated + easy", map:"https://www.google.com/maps/search/?api=1&query=Chakruna%20Native%20Burgers%20Cusco" },
      { name:"Jack’s Café", area:"Cusco · Center", price:"cheap-mid", why:"big portions", map:"https://www.google.com/maps/search/?api=1&query=Jack%27s%20Cafe%20Cusco" },
      { name:"Pachapapa", area:"Cusco · San Blas", price:"mid", why:"courtyard classic", map:"https://www.google.com/maps/search/?api=1&query=Pachapapa%20Cusco" },
      { name:"Green Point Vegan", area:"Cusco", price:"cheap-mid", why:"popular plant-based", map:"https://www.google.com/maps/search/?api=1&query=Green%20Point%20Vegan%20Cusco" },

      // Nazca
      { name:"Mamashana Café Restaurante", area:"Nazca", price:"mid", why:"best all-round pick", map:"https://www.google.com/maps/search/?api=1&query=Mamashana%20Nazca" },
      { name:"Restaurante La Encantada", area:"Nazca", price:"mid", why:"seafood + grill", map:"https://www.google.com/maps/search/?api=1&query=Restaurante%20La%20Encantada%20Nazca" },
      { name:"El Portón", area:"Nazca", price:"mid", why:"regional value", map:"https://www.google.com/maps/search/?api=1&query=El%20Port%C3%B3n%20Nazca" }
    ],
    budget: {
      range: "Jan 15–20",
      rate: "$1 = S/ 3.29",
      totalUSD: 1827,
      totalPEN: 6006,
      split: [
        { label:"Spent in Soles", primary:"S/ 3,442", secondary:"≈ $1,047" },
        { label:"Spent in USD", primary:"$780", secondary:"" }
      ],
      notes: [
        "Currency exchange “$300 → S/986” is not counted as spend.",
        "“Sushi” amount was not provided, so it’s excluded."
      ],
      days: [
        { day:"Jan 15", usd:319, pen:1049, key:"2026-01-15" },
        { day:"Jan 16", usd:77, pen:252, key:"2026-01-16" },
        { day:"Jan 17", usd:736, pen:2418, key:"2026-01-17" },
        { day:"Jan 18", usd:202, pen:664, key:"2026-01-18" },
        { day:"Jan 19", usd:161, pen:529, key:"2026-01-19" },
        { day:"Jan 20", usd:333, pen:1093, key:"2026-01-20" }
      ]
    }
  },

  mexico: {
    id:"mexico",
    name:"Yucatán Trip (Mexico)",
    routeLine:"Playa del Carmen → Mayan sites → Beach → Food",
    heroTitle:"Mexico, organized like a mission.",
    heroSub:"Your Yucatán plan lives here. Add more trips without breaking layout.",
    pills:["Multi-trip navigation","Mobile-first","Restaurants + photo spots"],
    googleMapUrl:"https://mexicosup.tiiny.site/?utm_source=ig&utm_medium=social&utm_content=link_in_bio",
    days: [
      { key:"mx-1", title:"Yucatán — Day 1", tags:["placeholder"], locations:["Playa del Carmen"], timeline:["Add your Mexico plan details here."] }
    ],
    restaurants: [],
    budget: null
  }
};

/* =========================
   APP STATE
========================= */
let currentTripId = "peru";

/* =========================
   DOM
========================= */
const topbar = document.getElementById("topbar");
const tripSelect = document.getElementById("tripSelect");
const routeLine = document.getElementById("routeLine");
const heroTitle = document.getElementById("heroTitle");
const heroSub = document.getElementById("heroSub");
const heroPills = document.getElementById("heroPills");

const openGoogleMapTop = document.getElementById("openGoogleMapTop");
const openGoogleMapHero = document.getElementById("openGoogleMapHero");
const footerGoogleMap = document.getElementById("footerGoogleMap");
const footerShare = document.getElementById("footerShare");

const viewPlan = document.getElementById("view-plan");
const viewMap = document.getElementById("view-map");
const viewFood = document.getElementById("view-food");
const viewBudget = document.getElementById("view-budget");

const goPlan = document.getElementById("goPlan");
const goMap = document.getElementById("goMap");

const drawerBackdrop = document.getElementById("drawerBackdrop");
const drawerTitle = document.getElementById("drawerTitle");
const drawerSub = document.getElementById("drawerSub");
const drawerBody = document.getElementById("drawerBody");
const drawerClose = document.getElementById("drawerClose");

function moneyUSD(n){ return "$" + n.toLocaleString("en-US"); }
function moneyPEN(n){ return "S/ " + n.toLocaleString("en-US"); }

/* =========================
   NAV (Header + Bottom)
========================= */
function setView(name){
  document.querySelectorAll(".view").forEach(v=>v.classList.remove("is-active"));
  document.getElementById(`view-${name}`).classList.add("is-active");

  document.querySelectorAll(".navBtn").forEach(b=>b.classList.toggle("is-active", b.dataset.view===name));
  document.querySelectorAll(".navItem").forEach(b=>b.classList.toggle("is-active", b.dataset.view===name));

  // reduce cognitive load: keep primary CTA aligned with view
  // (Same link, but this is where you’d swap CTA labels if needed)
}

document.querySelectorAll(".navBtn").forEach(b=>b.addEventListener("click", ()=>setView(b.dataset.view)));
document.querySelectorAll(".navItem").forEach(b=>b.addEventListener("click", ()=>setView(b.dataset.view)));

goPlan.addEventListener("click", ()=>setView("plan"));
goMap.addEventListener("click", ()=>setView("map"));

/* Sticky header hides on scroll down (desktop/tablet) */
let lastY = 0;
window.addEventListener("scroll", ()=>{
  const y = window.scrollY || 0;
  const goingDown = y > lastY && y > 60;
  if(window.innerWidth >= 980){
    topbar.classList.toggle("is-hidden", goingDown);
  } else {
    topbar.classList.remove("is-hidden");
  }
  lastY = y;
});

/* =========================
   DRAWER
========================= */
function openDrawer({title, sub, items}){
  drawerTitle.textContent = title;
  drawerSub.textContent = sub || "";
  drawerBody.innerHTML = items.map(r => `
    <div class="restItem">
      <div>
        <strong>${r.name}</strong>
        <small>${r.area} · ${r.price}${r.why ? " · " + r.why : ""}</small>
      </div>
      <a href="${r.map}" target="_blank" rel="noopener">Open</a>
    </div>
  `).join("") || `<div style="color:rgba(255,255,255,.7);padding:8px 0">No restaurant matches for this day yet.</div>`;
  drawerBackdrop.classList.add("is-open");
}
function closeDrawer(){
  drawerBackdrop.classList.remove("is-open");
}
drawerClose.addEventListener("click", closeDrawer);
drawerBackdrop.addEventListener("click", (e)=>{ if(e.target===drawerBackdrop) closeDrawer(); });

/* =========================
   RENDER
========================= */
function renderTripSelect(){
  tripSelect.innerHTML = Object.values(TRIPS).map(t => `
    <option value="${t.id}" ${t.id===currentTripId?"selected":""}>${t.name}</option>
  `).join("");
  tripSelect.addEventListener("change", ()=>{
    currentTripId = tripSelect.value;
    renderAll();
    window.scrollTo({top:0, behavior:"smooth"});
  });
}

function renderHero(trip){
  routeLine.textContent = trip.routeLine || "";
  heroTitle.textContent = trip.heroTitle || trip.name;
  heroSub.textContent = trip.heroSub || "";
  heroPills.innerHTML = (trip.pills || []).map(p=>`<span class="pill">${p}</span>`).join("");

  [openGoogleMapTop, openGoogleMapHero, footerGoogleMap].forEach(a=>{
    a.href = trip.googleMapUrl || "#";
  });

  footerShare.addEventListener("click", (e)=>{
    e.preventDefault();
    navigator.clipboard?.writeText(location.href).then(()=>alert("Link copied"));
  });
}

function renderPlan(trip){
  const header = `
    <div class="section">
      <div class="sectionHeader">
        <div>
          <h2>Trip Plan</h2>
          <p>Tap a day → see timeline. Restaurants open as a drawer.</p>
        </div>
        <button class="btn small" id="planJumpTop">Top</button>
      </div>
      <div class="sectionBody" id="planBody"></div>
    </div>
  `;
  viewPlan.innerHTML = header;

  document.getElementById("planJumpTop").addEventListener("click", ()=>window.scrollTo({top:0, behavior:"smooth"}));

  const planBody = document.getElementById("planBody");
  planBody.innerHTML = trip.days.map(d => `
    <article class="dayCard" data-itinerary-day="${d.key}">
      <div class="dayTop">
        <h3 class="dayTitle">${d.title}</h3>
        <div class="dayTags">${(d.tags||[]).slice(0,5).map(t=>`<span class="tag">${t}</span>`).join("")}</div>
      </div>

      <ul class="timeline">
        ${(d.timeline||[]).map(item=>{
          const parts = item.split("  ");
          if(parts.length >= 2){
            return `<li><span>${parts[0]}</span> ${parts.slice(1).join("  ")}</li>`;
          }
          return `<li>${item}</li>`;
        }).join("")}
      </ul>

      <div class="dayActions">
        <button class="btn primary" data-day="${d.key}">Restaurants for this day</button>
        <a class="btn" href="${trip.googleMapUrl}" target="_blank" rel="noopener" style="text-decoration:none;display:inline-flex;align-items:center;">Open map</a>
      </div>
    </article>
  `).join("");

  // Bind restaurant drawer
  planBody.querySelectorAll("button[data-day]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const dayKey = btn.dataset.day;
      const day = trip.days.find(x=>x.key===dayKey);
      const locs = (day.locations||[]).map(s=>s.toLowerCase());
      const matches = (trip.restaurants||[]).filter(r=>{
        const hay = (r.area + " " + r.name).toLowerCase();
        return locs.some(l => hay.includes(l));
      });
      openDrawer({
        title: "Restaurants",
        sub: `${day.title} · based on locations: ${(day.locations||[]).join(", ")}`,
        items: matches
      });
    });
  });
}

function renderMap(trip){
  const fallbackEmbed = `
    <iframe class="mapFrame" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
      src="https://www.google.com/maps/embed/v1/place?key=REPLACE_WITH_API_KEY&q=${encodeURIComponent(trip.routeLine || trip.name)}">
    </iframe>
  `;

  const embed = trip.mapEmbedUrl && trip.mapEmbedUrl.startsWith("http")
    ? `<iframe class="mapFrame" loading="lazy" src="${trip.mapEmbedUrl}"></iframe>`
    : `<div style="color:rgba(255,255,255,.75);padding:12px 0">No custom embed set. Use “Open Live Google Map”.</div>`;

  viewMap.innerHTML = `
    <div class="section">
      <div class="sectionHeader">
        <div>
          <h2>Map + Pins</h2>
          <p>Search pins. Open in Google Maps for navigation.</p>
        </div>
        <a class="ghostCta" href="${trip.googleMapUrl}" target="_blank" rel="noopener">Open Live Google Map</a>
      </div>
      <div class="sectionBody">
        ${embed}

        <div class="searchRow">
          <input id="pinSearch" placeholder="Search pins (e.g., Cusco, airport, Pachacamac)" />
          <button class="btn primary" id="fitPins">Show all pins</button>
        </div>

        <div class="pinList" id="pinList"></div>
      </div>
    </div>
  `;

  // Build pin list from restaurants + day locations (compact)
  const pins = [];
  (trip.days||[]).forEach(d=>{
    (d.locations||[]).forEach(loc=>{
      pins.push({ name: loc, area: "Location", map: `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc)}`});
    });
  });
  (trip.restaurants||[]).forEach(r=>{
    pins.push({ name: r.name, area: r.area, map: r.map });
  });

  // De-dupe pins by name+area
  const seen = new Set();
  const uniquePins = pins.filter(p=>{
    const k = (p.name+"|"+p.area).toLowerCase();
    if(seen.has(k)) return false;
    seen.add(k);
    return true;
  });

  const pinList = document.getElementById("pinList");
  const pinSearch = document.getElementById("pinSearch");

  function renderPins(filter=""){
    const f = filter.trim().toLowerCase();
    const list = uniquePins.filter(p=>{
      if(!f) return true;
      return (p.name+" "+p.area).toLowerCase().includes(f);
    }).slice(0, 40);

    pinList.innerHTML = list.map(p=>`
      <div class="pinItem">
        <div>
          <strong>${p.name}</strong>
          <small>${p.area}</small>
        </div>
        <a href="${p.map}" target="_blank" rel="noopener">Open</a>
      </div>
    `).join("") || `<div style="color:rgba(255,255,255,.7);padding:8px 0">No pins match your search.</div>`;
  }
  renderPins("");

  pinSearch.addEventListener("input", ()=>renderPins(pinSearch.value));
  document.getElementById("fitPins").addEventListener("click", ()=>{
    pinSearch.value = "";
    renderPins("");
    window.scrollTo({top:0, behavior:"smooth"});
  });
}

function renderFood(trip){
  const byArea = {};
  (trip.restaurants||[]).forEach(r=>{
    const key = r.area || "Other";
    byArea[key] = byArea[key] || [];
    byArea[key].push(r);
  });

  viewFood.innerHTML = `
    <div class="section">
      <div class="sectionHeader">
        <div>
          <h2>Food</h2>
          <p>Short, curated list. Open locations directly in Maps.</p>
        </div>
        <button class="btn small" id="foodQuick">Open day restaurants</button>
      </div>
      <div class="sectionBody">
        ${Object.keys(byArea).sort().map(area=>`
          <div class="dayCard">
            <div class="dayTop">
              <h3 class="dayTitle">${area}</h3>
              <div class="dayTags"><span class="tag">${byArea[area].length} spots</span></div>
            </div>
            <div style="margin-top:10px">
              ${byArea[area].map(r=>`
                <div class="restItem">
                  <div>
                    <strong>${r.name}</strong>
                    <small>${r.price}${r.why ? " · "+r.why : ""}</small>
                  </div>
                  <a href="${r.map}" target="_blank" rel="noopener">Open</a>
                </div>
              `).join("")}
            </div>
          </div>
        `).join("") || `<div style="color:rgba(255,255,255,.7)">No restaurants added for this trip yet.</div>`}
      </div>
    </div>
  `;

  document.getElementById("foodQuick").addEventListener("click", ()=>{
    // open drawer for first day as “default” to guide dumb users
    const first = trip.days?.[0];
    if(!first) return;
    const locs = (first.locations||[]).map(s=>s.toLowerCase());
    const matches = (trip.restaurants||[]).filter(r=>{
      const hay = (r.area + " " + r.name).toLowerCase();
      return locs.some(l => hay.includes(l));
    });
    openDrawer({ title:"Restaurants", sub:first.title, items: matches });
  });
}

function renderBudget(trip){
  if(!trip.budget){
    viewBudget.innerHTML = `
      <div class="section">
        <div class="sectionHeader"><h2>Budget</h2><p>No budget added for this trip yet.</p></div>
        <div class="sectionBody" style="color:rgba(255,255,255,.72)">Add a budget object to TRIPS.${trip.id}.budget</div>
      </div>
    `;
    return;
  }

  const b = trip.budget;
  viewBudget.innerHTML = `
    <div class="section">
      <div class="sectionHeader">
        <div>
          <h2>Budget</h2>
          <p>High-level numbers first. Day drill-down only if needed.</p>
        </div>
      </div>
      <div class="sectionBody">
        <section class="budgetCard">
          <div class="budgetHeader">
            <h2>Trip Spend (${b.range})</h2>
            <div class="budgetMeta">
              <span class="pill">${b.rate}</span>
            </div>
          </div>

          <div class="budgetTop">
            <div class="budgetTotal">
              <div class="label">Total Spend</div>
              <div class="value">${moneyUSD(b.totalUSD)}</div>
              <div class="sub">≈ ${moneyPEN(b.totalPEN)}</div>
            </div>

            <div class="budgetSplit">
              ${b.split.map(s=>`
                <div class="splitRow">
                  <span>${s.label}</span>
                  <strong>${s.primary}</strong>
                  ${s.secondary ? `<em>${s.secondary}</em>` : `<em></em>`}
                </div>
              `).join("")}
            </div>
          </div>

          <details class="budgetNotes">
            <summary>Notes</summary>
            <ul>${b.notes.map(n=>`<li>${n}</li>`).join("")}</ul>
          </details>

          <div class="budgetDays">
            ${b.days.map(d=>`
              <button class="dayRow" data-itinerary-jump="${d.key}">
                <span>${d.day}</span><strong>${moneyUSD(d.usd)}</strong><em>≈ ${moneyPEN(d.pen)}</em>
              </button>
            `).join("")}
          </div>
        </section>
      </div>
    </div>
  `;

  // Jump to itinerary day from budget
  viewBudget.querySelectorAll("[data-itinerary-jump]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const key = btn.dataset.itineraryJump;
      setView("plan");
      setTimeout(()=>{
        const target = document.querySelector(`[data-itinerary-day="${key}"]`);
        if(target) target.scrollIntoView({behavior:"smooth", block:"start"});
      }, 80);
    });
  });
}

function renderAll(){
  const trip = TRIPS[currentTripId];
  renderTripSelect();
  renderHero(trip);
  renderPlan(trip);
  renderMap(trip);
  renderFood(trip);
  renderBudget(trip);

  // Default: keep Plan active for “dumb user”
  setView("plan");
}

/* =========================
   INIT
========================= */
renderAll();
</script>
</body>
</html>